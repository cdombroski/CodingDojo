(ns bankocr.core-test
  (:use bankocr.core clojure.test))

(def case1-accounts (str
                      " _  _  _  _  _  _  _  _  _ \n"
                      "| || || || || || || || || |\n"
                      "|_||_||_||_||_||_||_||_||_|\n\n"
                      "                           \n"
                      "  |  |  |  |  |  |  |  |  |\n"
                      "  |  |  |  |  |  |  |  |  |\n\n"
                      " _  _  _  _  _  _  _  _  _ \n"
                      " _| _| _| _| _| _| _| _| _|\n"
                      "|_ |_ |_ |_ |_ |_ |_ |_ |_ \n\n"
                      " _  _  _  _  _  _  _  _  _ \n"
                      " _| _| _| _| _| _| _| _| _|\n"
                      " _| _| _| _| _| _| _| _| _|\n\n"
                      "                           \n"
                      "|_||_||_||_||_||_||_||_||_|\n"
                      "  |  |  |  |  |  |  |  |  |\n\n"
                      " _  _  _  _  _  _  _  _  _ \n"
                      "|_ |_ |_ |_ |_ |_ |_ |_ |_ \n"
                      " _| _| _| _| _| _| _| _| _|\n\n"
                      " _  _  _  _  _  _  _  _  _ \n"
                      "|_ |_ |_ |_ |_ |_ |_ |_ |_ \n"
                      "|_||_||_||_||_||_||_||_||_|\n\n"
                      " _  _  _  _  _  _  _  _  _ \n"
                      "  |  |  |  |  |  |  |  |  |\n"
                      "  |  |  |  |  |  |  |  |  |\n\n"
                      " _  _  _  _  _  _  _  _  _ \n"
                      "|_||_||_||_||_||_||_||_||_|\n"
                      "|_||_||_||_||_||_||_||_||_|\n\n"
                      " _  _  _  _  _  _  _  _  _ \n"
                      "|_||_||_||_||_||_||_||_||_|\n"
                      " _| _| _| _| _| _| _| _| _|\n\n"
                      "    _  _     _  _  _  _  _ \n"
                      "  | _| _||_||_ |_   ||_||_|\n"
                      "  ||_  _|  | _||_|  ||_| _|\n\n"))

(deftest case1 []
  (is (= [[0 0 0 0 0 0 0 0 0]
          [1 1 1 1 1 1 1 1 1]
          [2 2 2 2 2 2 2 2 2]
          [3 3 3 3 3 3 3 3 3]
          [4 4 4 4 4 4 4 4 4]
          [5 5 5 5 5 5 5 5 5]
          [6 6 6 6 6 6 6 6 6]
          [7 7 7 7 7 7 7 7 7]
          [8 8 8 8 8 8 8 8 8]
          [9 9 9 9 9 9 9 9 9]
          [1 2 3 4 5 6 7 8 9]]
        (read-account-numbers (java.io.StringReader. case1-accounts)))))

(def case2-accounts (str
                      "    _  _  _  _  _  _  _  _ \n"
                      "|_||_   ||_ | ||_|| || || |\n"
                      "  | _|  | _||_||_||_||_||_|\n\n"
                      " _  _     _  _        _  _ \n"
                      "|_ |_ |_| _|  |  ||_||_||_ \n"
                      "|_||_|  | _|  |  |  | _| _|\n\n"))

(deftest case2 []
  (is (= [true false]
        (map checksum (read-account-numbers (java.io.StringReader. case2-accounts))))))

(def case3-accounts (str
                      case2-accounts
                      " _  _  _  _  _  _  _  _    \n"
                      "| || || || || || || ||_   |\n"
                      "|_||_||_||_||_||_||_| _|  |\n\n"
                      "    _  _  _  _  _  _     _ \n"
                      "|_||_|| || ||_   |  |  | _ \n"
                      "  | _||_||_||_|  |  |  | _|\n\n"
                      "    _  _     _  _  _  _  _ \n"
                      "  | _| _||_| _ |_   ||_||_|\n"
                      "  ||_  _|  | _||_|  ||_| _ \n\n"))

(deftest case3 []
  (is (= [[4 5 7 5 0 8 0 0 0]
          [6 6 4 3 7 1 4 9 5 :err]
          [0 0 0 0 0 0 0 5 1]
          [4 9 0 0 6 7 7 1 \? :ill]
          [1 2 3 4 \? 6 7 8 \? :ill]]
        (check-accounts (read-account-numbers (java.io.StringReader. case3-accounts))))))